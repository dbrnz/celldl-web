<html>
    <head>
        <meta charset="utf-8"/>
        <style type="text/css">
            .CodeMirror, .border {
                border: 2px solid #888;
            }
            input {
                margin-left: 15px;
                margin-top: 15px;
                margin-bottom: 0px;
            }
            svg {
                cursor: pointer;
                border: 2px solid #000080;
                pointer-events: visible;
            }
            #celldl-editor {
                width: 45%;
                height: 100%;
            }
            #editor-resize {
                width: 8px;
                height: 100%;
                cursor: ew-resize;
            }
            #cell-diagram {
                flex: 11 11 55%;
                height: 100%;
            }
            #palette {
                width: 5%;
                height: 100%;
                align-self: flex-start;
            }
            #footer {
                width: 45%;
            }
            #footer1 {
                flex: 11 11 55%;
            }
            #flex {
                display: flex;
                width: 100%;
                height: 100%;
            }
            #flex-footer {
                display: flex;
                width: 100%;
                margin-bottom: 20px;
            }
            #flex-rows {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100%;
            }
        </style>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                jax: ["input/TeX", "output/SVG"],
                messageStyle: "none",
                showProcessingMessages: false,
                skipStartupTypeset: true,
                showMathMenu: false,
                showMathMenuMSIE: false,
                TeX: {
                    extensions: window.Array(
                        "AMSmath.js",
                        "AMSsymbols.js",
                        "autoload-all.js"
                    )
                },
                SVG: {
                    font: "STIX-Web",
                    useFontCache: true,
                    useGlobalCache: false,  // Can we set true and extract global <defs> ??
                    EqnChunk: 1000000,
                    EqnDelay: 0
                } /* ,
                tex2jax: {
                    inlineMath: [['$','$'],['\\(','\\)']]
                } */
            });
        </script>
        <script type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js">
        </script>
        <script src="./thirdparty/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8">
        <script type="text/javascript"
                src="./thirdparty/jsnetworkx.js">
        </script>
        </script>
        <script type="module">
            import {TextEditor} from './script/textEditor.js';
            const editor = new TextEditor();

            // Expose editor's functions to HTML elements

            window.loadCellDl = (files) => editor.loadCellDl(files);
            window.saveCellDl = () => editor.saveCellDl();
            window.previewSvg = () => editor.previewSvg();
            window.exportSvg = () => editor.exportSvg();
        </script>
    </head>
    <body>
        <div id="flex-rows">
          <div id="flex">
            <div id="celldl-editor"></div>
            <div id="editor-resize"></div>
            <section id="cell-diagram" class="border"></section>
            <section id="palette" class="border"></section>
          </div>
          <div id="flex-footer">
            <section id="footer">
                <input type="file" id="loadCellDlFile" accept=".xml, .celldl"
                       style="display:none" onchange="loadCellDl(this.files)">
                <input type="button" value="Load CellDL" onclick="loadCellDlFile.click()"/>
                <input type="button" value="Save CellDL" onclick="saveCellDl()"/>
                <input type="button" value="Preview SVG" onclick="previewSvg()"/>
            </section>
            <section id="footer1">
                <input type="button" value="Export SVG"  onclick="exportSvg()"/>
            </section>
          </div>
        </div>


        <!-- Allow our editor windows to be resized -->
        <script>
            const editorResize = document.getElementById('editor-resize');
            editorResize.addEventListener('mousedown', initialiseResize, false);

            const celldlEditor = document.getElementById('celldl-editor');
            const editorFooter = document.getElementById('footer');

            function initialiseResize(event)
            {
                window.addEventListener('mousemove', startResizing, false);
                window.addEventListener('mouseup', stopResizing, false);
            }

            function startResizing(event)
            {
               celldlEditor.style.width = (event.clientX - celldlEditor.offsetLeft) + 'px';
               editorFooter.style.width = (event.clientX - editorFooter.offsetLeft) + 'px';
            }

            function stopResizing(event)
            {
                window.removeEventListener('mousemove', startResizing, false);
                window.removeEventListener('mouseup', stopResizing, false);
            }
        </script>
<!-- Have some way of specifying local stylesheets?
     * file:// means we use FileReader API instead of fetch() ??
     * https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications
       and trigger a download to save data.
-->
    </body>
</html>
